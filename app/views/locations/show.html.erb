<section class="main-container">
  <div class="container">
    <aside class="chapter-aside">
      <div class="state-container-aside">
        <%= link_to image_tag(image_route(@location.state)), locations_path %>
      </div>
      <hr>
      <h1><%= @location.location %></h1>

      <%= render partial: "social_media_chapter", locals: {user: @location} %>

      <p class="subtitle">- don't be shy -</p>
      <%= link_to "{ Join Us }", "http://www.meetup.com/#{@location.meetup}", :class=>"button" %>

      <div class="hide">
        <h2>Sponsors</h2>
        <% @sponsors.each do |sponsor| %>
          <% if sponsor.image? %>
            <p><%= link_to image_tag(sponsor.image.url), sponsor.url %></p>
          <% end %>
        <% end %>
      </div>
    </aside>

    <section id="content-section">
      <div id="headline">
        <%= image_tag 'pencil.png' %>
        <h2>Upcoming Events</h2>
      </div>

      <div class="classes">
      </div>

      <% if @leaders.count != 0 %>
        <div id="headline">
          <%= image_tag 'flourish.png' %>
          <h2>Chapter Leaders</h2>
        </div>
      <% end %>

      <div class="profiles">

        <% @leaders.each do |bio| %>
          <div class="single-profile">
            <div class="profile-img">
              <% if bio.image? %>
                <%= image_tag bio.image %>
              <% elsif bio.pic_link? %>
                <%= image_tag bio.pic_link %>
              <% else %>
                <%= image_tag "photo-not-available.jpg" %>
              <% end %>
            </div>

            <div class="profile-content">
              <h3><%= bio.name %></h3>
              <%= bio.info.html_safe %>

              <%= render partial: "social_media_bio", locals: {bio: bio} %>
            </div>
          </div>
        <% end %>
      </div>

      <div class="profiles">
        <% if @instructors.count != 0 %>
          <div id="headline">
            <%= image_tag 'apple.png' %>
            <h2>The Instructors</h2>
          </div>
        <% end %>

        <% @instructors.each do |bio| %>
          <div class="single-profile">
            <div class="profile-img">
              <% if bio.image? %>
                <%= image_tag bio.image %>
              <% elsif bio.pic_link? %>
                <%= image_tag bio.pic_link %>
              <% else %>
                <%= image_tag "photo-not-available.jpg" %>
              <% end %>
            </div>

            <div class="profile-content">
              <h3><%= bio.name %></h3>
              <%= bio.info.html_safe %>

              <%= render partial: "social_media_bio", locals: {bio: bio} %>

            </div>
          </div>
        <% end %>
      </div>

      <script type="text/template" id="meetup">

        <h3><a href=" <%%= event_url %>"><%%= name %></a></h3>
        <p class="subtitle">[ <%%=moment(time).format("MMMM Do YYYY, h:mm a")%>
          <%% if(typeof venue !== "undefined") { %>
          <%%= venue.address_1 %>,
          <%%= venue.city %>
          <%% } %>
         ] </p>
        <p><%%= description.substring(0, 400) %><a href="<%%= event_url %>">...read more</a></p>
        <a href="<%%= event_url %>" class="button">RSVP</a>
      </script>


      <script type="text/javascript">
        var meetup_url = '/meetups/<%= params[:id] %>.json';
        $.getJSON(meetup_url).done(function (classesData){
            console.log("here are all the classes", classesData);
          if(classesData.length>0) {
            var classesArr = classesData.slice(0,3);
            console.log(classesArr);
            var oneClass = '';
            var classes = $('#meetup').html();
              _.each(classesArr, function (one) {
              oneClass += _.template(classes, one);
                $(".classes").html(oneClass);
            });
          } else {
            $(".classes").html("<p class=\"uhOh\">Sadly, no meetups are currently scheduled. <a href=\"http://meetup. com/<%= @location.meetup %>\">Join our meetup group</a> to be notified when a new meetup is happening.</p>")};
          });

      </script>
    </section>
  </div>
</section>
